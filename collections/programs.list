<style>
	.custom-bg-region {background-repeat: no-repeat; background-position: center 50px; padding-top: 50px;}
	.col {float: unset!important;}
    .sqs-block-quote .sqs-block-content {margin: 15px 0px;}
</style>

{@|apply header.block}
<header class="site-header">
	<h1 class="hover" onclick="window.open('{collection.fullUrl}','_self')"  id="page-title-h1">{collection.title}</h1>
	{.if item.title}<h1><span class="red-text sub-title">{item.title}</span></h1>{.end}
</header>
{@|apply calendarBuilder.block}

<squarespace:query collection="events" limit="100">
    {.repeated section items}
	<script>
		{#  Event Date  }		
		var startMonth = {structuredContent.startDate|date %m} - 1;
		var startDate = {structuredContent.startDate|date %e};
		var endMonth = {structuredContent.endDate|date %m} - 1;
		var endDate = {structuredContent.endDate|date %e}

		{#  Single or Ongoing Day Event  }
		if (endMonth - startMonth === 0 && endDate - startDate === 0){
			var targetDate = startMonth + "_" + startDate
			var eventCalendarContent = `
			<div id="{urlId}" class="event {.if customContent.programClickable} clickable {.end} {.if starred} special-event {.or} regular-event {.end}" {.if customContent.programClickable} {.if sourceUrl} onclick="window.open('{sourceUrl}')" {.or} onclick="toggleEvent('{fullUrl}')"{.end} {.end} style="order: {structuredContent.startDate|date %k}">
				<p class="{.if starred} special-event-title {.or} regular-event-title {.end}">{title}</p>
				{.if customContent.showTime}<p class="event-time">{structuredContent.startDate|date %l:%M %p} to {structuredContent.endDate|date %l:%M %p} {.end}
				{.if excerpt}<p class="event-excerpt">{excerpt|safe}</p>{.end}
			</div>
			`
			$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)
			{.if starred} $('#' + targetDate).addClass("special-event-border") {.end}
		} else {
			var targetDate = startMonth + "_" + startDate
			var eventCalendarContent = `
			<div id="{urlId}" class="event ongoing-event{.if customContent.programClickable} clickable {.end} {.if starred} special-event {.or} ongoing-event {.end}" {.if customContent.programClickable} {.if sourceUrl} onclick="window.open('{sourceUrl}')" {.or} onclick="toggleEvent('{fullUrl}')"{.end} {.end} style="order: 1!important">
				<p class="ongoing-event-title">{title}</p>
				{.if customContent.showTime}<p class="event-time">{structuredContent.startDate|date %l:%M %p} to {structuredContent.endDate|date %l:%M %p} {.end}
				{.if excerpt}<p class="event-excerpt">{excerpt|safe|truncate 45}</p>{.end}
			</div>
			`

			var monthDifference = endMonth - startMonth; 
			var dateDifference = endDate - startDate; 
			if (monthDifference === 0){
				for (i = 0; i <= dateDifference; i++){
					var targetDate = startMonth + "_" + (startDate + i);
					$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)
				}
			} else {
				for (i = 0; i <= monthDifference; i++){
					var monthToAddEvents = ((startMonth) + i)
					if (i === 0){
						var daysInMonth =  $('#' + monthToAddEvents + "-table .live-date").length;
						for (j = 0; j <= daysInMonth - startDate; j++){
							var targetDate = monthToAddEvents + "_" + (startDate + j);
							$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)	
							}
					} else {
						for (j = 0; j <= endDate; j++){
							var targetDate = monthToAddEvents + "_" + (j);
							$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)	
							}
					}
				}
			}
		}
	</script>
    {.end}
</squarespace:query>

<div id="eventPopup" class="flex-start-center" style="display: none;">
	<div class="textured-bg" id="eventPopupWindow">
		<div id="eventPopupClose" class="flex-center-center">Close</div>
		<div style="max-height: calc(88vh - 71px);" id="eventWrapper">
		
		<iframe id="eventPopupIframe" style="height: 80vh; border: 0px;" src=""></iframe>
		
		</div>
	</div>
</div>

{@|apply footer.block}

<script>
function closePopup(){
	document.getElementById('eventPopup').style.display = "none";
	$("body").css({"height": "unset", "overflow": "scroll"})
	$("#eventPopupIframe").attr("src", "")
}

function toggleEvent(url){
	if (document.getElementById('eventPopup').style.display === "none"){
		document.getElementById('eventPopup').style.display = "flex";
		$("#eventPopupIframe").attr("src", url)
		$("body").css({"height": "100vh", "overflow": "hidden"})
	} else if (document.getElementById('eventPopup').style.display === "flex") {
		closePopup()
	}
}

document.getElementById("eventPopupClose").addEventListener("click", closePopup);



 
</script>