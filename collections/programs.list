<style>
	.custom-bg-region {background-repeat: no-repeat; background-position: center 50px; padding-top: 50px;}
</style>
{@|apply header.block}
<header class="site-header">
	<h1 class="hover" onclick="window.open('{collection.fullUrl}','_self')"  id="page-title-h1">{collection.title}</h1>
	{.if item.title}<h1><span class="red-text sub-title">{item.title}</h1>{.end}
</header>

{@|apply calendarBuilder.block}
{@|apply footer.block}

{.repeated section items}
	{.equal? customContent.customType "eventOngoing"}
		<script>
			var ongoingTitle = "{title}";
			var ongoingStartMonth = {structuredContent.startDate|date %m} - 1;
			var ongoingStartDate = {structuredContent.startDate|date %e};
			var ongoingEndMonth = {structuredContent.endDate|date %m} - 1;
			var ongoingEndDate = {structuredContent.endDate|date %e}
			var ongoingDateCell = String(ongoingStartMonth) + "-" + String(ongoingStartDate)
			
			{.if customContent.showTime} 
				var ongoingTime = "<span class='event-time'>{structuredContent.startDate|date %l:%M %p} to {structuredContent.endDate|date %l:%M %p}</span>"
			{.or} 
				var ongoingTime = "";
			{.end}

			{.if customContent.programClickable}
				{.if sourceUrl}
				var source = `onclick='window.open("{sourceUrl}")'`
				var ongoingContainer = "<div class='event-details ongoing-event event-container has-time clickable' data-military-time={structuredContent.startDate|date %H}>"
				{.or}
				var source = `onclick='toggleEventPopup("https://salontwenty-one.com/events/" + "{urlId}")'`
				{.end}
				var ongoingContainer = "<div class='event-details ongoing-event event-container has-time hover clickable' data-military-time={structuredContent.startDate|date %H} " + source +">"

			{.or}
				var ongoingContainer = "<div class='event-details ongoing-event event-container has-time non-clickable' data-military-time={structuredContent.startDate|date %H}>"
			{.end}
			
			
			
			var eventTitle = ongoingContainer + "<p class='event-details-title ongoing-event-title'>" + ongoingTitle + ongoingTime + "</p></div>"
			var ongoingEventRange = (ongoingEndDate - ongoingStartDate);
			if(ongoingEventRange > 0){
				for (i = 0; i < ongoingEventRange + 1; i++){
					var nextDay = ongoingStartDate + i
					var ongoingDateCellMulti = String(ongoingStartMonth) + "_" + String(ongoingStartDate + i)
					$("#" + ongoingDateCellMulti + " .event-wrapper").append(eventTitle)
					$("#" + ongoingDateCellMulti).addClass('has-event')
				}
			} else {}
		</script>
	{.end}

	{.equal? customContent.customType "eventSpecial"}
		<script>
			var specialTitle = "{title}";
			var specialStartMonth = {structuredContent.startDate|date %m} - 1;
			var specialStartDate = {structuredContent.startDate|date %e};
			var specialEndMonth = {structuredContent.endDate|date %m} - 1;
			var specialEndDate = {structuredContent.endDate|date %e}
			var specialDateCell = String(specialStartMonth) + "_" + String(specialStartDate)
			{.if customContent.showTime} 
				var specialShowTime = "<span class='event-time'>{structuredContent.startDate|date %l:%M %p} to {structuredContent.endDate|date %l:%M %p}</span>"
			{.or} 
				var specialShowTime = ""
			{.end}
			
			{.if customContent.programClickable} 
				{.if sourceUrl} 
				
				var specialContainer = "<div class='event-details{.if starred}special-event {.or} regular-event {.end} event-container {.if customContent.showTime}has-time' data-military-time={structuredContent.startDate|date %H} {.or}' {.end} onclick='window.open("+ {sourceUrl} +")'>"
				{.or} 
					var source = `"https://salontwenty-one.com/events/" + "{urlId}"`
					var specialContainer = "<div class='event-details {.if starred}special-event {.or} regular-event {.end} event-container {.if customContent.showTime}has-time' data-military-time={structuredContent.startDate|date %H} {.or}' {.end} onclick='toggleEventPopup("+ source + ", `" + specialDateCell + "`)'>"
				{.end}
			{.or} 
				var specialContainer = "<div class='event-details non-clickable {.if starred}special-event {.or} regular-event {.end} event-container {.if customContent.showTime}has-time' data-military-time={structuredContent.startDate|date %H} {.or}' {.end}>"
			{.end}
			
			{.if excerpt}
				var specialExcerpt = "<br class='mobile-breaks'><span class='event-excerpt'> " + `{excerpt|safe}` + "</span>"
				{.or}
				var specialExcerpt = ""
			{.end}
			
			
			var specialEvent = specialContainer + "<p class='{.if customContent.programClickable} hover {.end} event-details-title {.if starred}special-event-title {.or} regular-event-title {.end}'>" + specialTitle +  specialExcerpt + "<br class='mobile-breaks'>" + specialShowTime + "</p></div>"
			var specialEventRange = (specialEndDate - specialStartDate);
			$("#" + specialDateCell + " .event-wrapper").append(specialEvent)
			$("#" + specialDateCell ).addClass('has-event')
			{.if starred}
				$("#" + specialDateCell).addClass('special-event-border')
			{.end}
			
		</script>
	{.end}
{.end}
<div id="eventPopup" class="flex-start-center" style="display: none;">
	<div style="border: 3px solid white; width: 90vw; height: 88vh; margin: 2.5vw">
		<div id="eventPopupClose" class="flex-center-center">Close</div>
		<iframe id="eventIframe" style="height: calc(88vh - 71px);" class="textured-bg"></iframe>
	</div>
</div>

<script>



var scrollPosition;

function toggleEventPopup(source, sourceId){
	scrollPosition = sourceId
	if (document.getElementById('eventPopup').style.display === "none"){
		document.getElementById('eventPopup').style.display = "flex";
		document.getElementById('eventIframe').src = source;
		document.body.classList.add('no-scroll');
	} else if (document.getElementById('eventPopup').style.display === "flex") {
		closePopup()
	}
}

function closePopup(){
	document.getElementById('eventIframe').src = ""
	document.getElementById('eventPopup').style.display = "none";
	document.body.classList.remove('no-scroll');
	var targetDiv = document.getElementById(scrollPosition);
	targetDiv.scrollIntoView({ behavior: 'instant', block: 'center' });
}

document.getElementById("eventPopup").addEventListener("click", closePopup);


{#  After calendar has been loaded  }



var closuresList = ['8_17', '8_18', '8_24', '8_25', '9_1', '9_2', '9_8', '9_9', '9_15', '9_16', '9_22', '9_23', '9_29', '9_30', '10_5', '10_6', '10_12', '10_13', '10_19', '10_20', '10_26', '10_27', '10_23', '10_24', '11_3', '11_4', '11_10', '11_11', '11_17', '11_18', '11_24', '11_25', '11_26', '11_27', '11_28', '11_29', '11_30', '11_31', '0_1', '0_2', '0_8', '0_9', '0_15', '0_16', '0_22', '0_23', '0_29', '0_30' ]

console.log(closuresList)
	function closures(closuresList){
		for (i = 0; i < closuresList.length; i++){
			var targetClosure = document.getElementById(closuresList[i])
			$('#' + closuresList[i] ).addClass("closed")
		$('#' + closuresList[i] ).find('.event-wrapper').html("<p class='closed-p'>Closed<p>")
		
		}
	}
	
	closures(closuresList)

 function orderEvents(list){
	for(i=0; i<list.length; i++){
		var time = $(list[i]).attr("data-military-time");
		$(list[i]).css("order", time);
	}
 }
 {#  Organize events on day by start times  }
 var hasTimeList = document.getElementsByClassName('has-time');
 orderEvents(hasTimeList)
 

</script>
