<style>
	.custom-bg-region {background-repeat: no-repeat; background-position: center 50px; padding-top: 50px;}
	.col {float: unset!important;}
    .sqs-block-quote .sqs-block-content {margin: 15px 0px;}
</style>
{@|apply header.block}
<header class="site-header">
	<h1 class="hover" onclick="window.open('{collection.fullUrl}','_self')"  id="page-title-h1">{collection.title}</h1>
	{.if item.title}<h1><span class="red-text sub-title">{item.title}</span></h1>{.end}
</header>
{@|apply calendarBuilder.block}



<squarespace:query collection="events" limit="100">
    {.repeated section items}
	<script>
		{#  Event Date  }		
		var startMonth = {structuredContent.startDate|date %m} - 1;
		var startDate = {structuredContent.startDate|date %e};
		var endMonth = {structuredContent.endDate|date %m} - 1;
		var endDate = {structuredContent.endDate|date %e}

		{#  Single or Ongoing Day Event  }
		if (endMonth - startMonth === 0 && endDate - startDate === 0){
			var targetDate = startMonth + "_" + startDate
			var eventCalendarContent = `
			<div id="{urlId}" class="event {.if customContent.programClickable} clickable {.end} {.if starred} special-event {.or} regular-event {.end}" {.if customContent.programClickable} {.if sourceUrl} onclick="window.open({sourceUrl})" {.or} onclick="toggleEvent('{fullUrl}')"{.end} {.end} style="order: {structuredContent.startDate|date %k}">
				<p class="{.if starred} special-event-title {.or} regular-event-title {.end}">{title}</p>
				{.if customContent.showTime}<p class="event-time">{structuredContent.startDate|date %l:%M %p} to {structuredContent.endDate|date %l:%M %p} {.end}
				{.if excerpt}<p class="event-excerpt">{excerpt|safe}</p>{.end}
			</div>
			
			`
			$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)
			{.if starred} $('#' + targetDate).addClass("special-event-border") {.end}
		} else {
			var targetDate = startMonth + "_" + startDate
			var eventCalendarContent = `
			<div id="{urlId}" class="event ongoing-event{.if customContent.programClickable} clickable {.end} {.if starred} special-event {.or} ongoing-event {.end}" {.if customContent.programClickable} {.if sourceUrl} onclick="window.open({sourceUrl})" {.or} onclick="toggleEvent('{fullUrl}')"{.end} {.end} style="order: 1!important">
				<p class="ongoing-event-title">{title}</p>
				{.if customContent.showTime}<p class="event-time">{structuredContent.startDate|date %l:%M %p} to {structuredContent.endDate|date %l:%M %p} {.end}
				{.if excerpt}<p class="event-excerpt">{excerpt|safe|truncate 45}</p>{.end}
				
			</div>
			
			`

			var monthDifference = endMonth - startMonth; 
			var dateDifference = endDate - startDate; 
			console.log(monthDifference + " " + dateDifference)
			if (monthDifference === 0){
				for (i = 0; i <= dateDifference; i++){
					var targetDate = startMonth + "_" + (startDate + i);
					console.log(targetDate)
					$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)
				}
			} else {
				for (i = 0; i <= monthDifference; i++){
					console.log("month difference: " + monthDifference)
					var daysInMonth =  $('#' + (startMonth - 1) + "-table .live-date").length;
					
					for (i = 0; i <= daysInMonth - startDate; i++){
					var targetDate = startMonth + "_" + (startDate + i);
					console.log(targetDate)
					$('#' + targetDate + " .event-wrapper").append(eventCalendarContent)
				}
				}
			}
		}
	</script>
    {.end}

</squarespace:query>


{@|apply footer.block}

<script>

function toggleEvent(url){
	if (document.getElementById('eventPopup').style.display === "none"){
		console.log(url)
		document.getElementById('eventPopup').style.display = "flex";
		
		document.getElementById('eventWrapper').scroll(0,0)
		$("body").css("overflow","hidden!important");
		$("#eventPopupIframe").attr("src", url)
	} else if (document.getElementById('eventPopup').style.display === "flex") {
		closePopup()
	}
}

</script>


<div id="eventPopup" class="flex-start-center" style="display: none;">
	<div class="textured-bg" id="eventPopupWindow">
		<div id="eventPopupClose" class="flex-center-center">Close</div>
		<div style="max-height: calc(88vh - 71px);" id="eventWrapper">
		
		<iframe id="eventPopupIframe" style="height: 85vh" src=""></iframe>
		
		</div>
	</div>
</div>

<script>



var scrollPosition;

function toggleEventPopup(id, sourceId){
	scrollPosition = sourceId
	if (document.getElementById('eventPopup').style.display === "none"){
		document.getElementById('eventPopup').style.display = "flex";
		
		document.getElementById('eventWrapper').scroll(0,0)
		$("body").css("overflow","hidden!important");
	} else if (document.getElementById('eventPopup').style.display === "flex") {
		closePopup()
	}
}

function closePopup(){
	var openWindow = document.getElementsByClassName('event-frame')
	for (i=0; i < openWindow.length; i++){
		if (openWindow[i].classList.contains('hidden-event-frame')){
		} else {
			openWindow[i].classList.add('hidden-event-frame')
		}
	}
	document.getElementById('eventPopup').style.display = "none";
	document.body.classList.remove('no-scroll');
	var targetDiv = document.getElementById(scrollPosition);
	targetDiv.scrollIntoView({ behavior: 'instant', block: 'center' });
}


document.getElementById("eventPopupClose").addEventListener("click", closePopup);

{#  After calendar has been loaded  }



var closuresList = ['9_2', '9_3', '9_8', '9_21', '9_22', '10_17', '10_18', '10_22', '10_23', '10_24', '10_25', '10_26',  '11_3', '11_4', '11_10', '11_11', '11_17', '11_18', '11_24', '11_25', '11_26', '11_27', '11_28', '11_29', '11_30', '11_31', '0_1', '0_2', '0_8', '0_9', '0_15', '0_16', '0_22', '0_23', '0_29', '0_30' ]
	function closures(closuresList){
		for (i = 0; i < closuresList.length; i++){
			var targetClosure = document.getElementById(closuresList[i])
			$('#' + closuresList[i] ).addClass("closed")
		$('#' + closuresList[i] ).find('.event-wrapper').html("<div class='closed-event flex-center-center flex-column'><p class='closed-p'>Closed<p></div>")
		
		}
	}
	
	closures(closuresList)

 function orderEvents(list){
	for(i=0; i<list.length; i++){
		var time = $(list[i]).attr("data-military-time");
		$(list[i]).css("order", time);
	}
 }
 {#  Organize events on day by start times  }
 var hasTimeList = document.getElementsByClassName('has-time');
 orderEvents(hasTimeList)
 var extraExcerpt = "<p class='excerpt'>Email alex@salontwenty-one.com to request private viewing</p>"
 
 $('#9_9 .event-details .ongoing-event-title').append(extraExcerpt)
 $('#9_10 .event-details .ongoing-event-title').append(extraExcerpt)
 $('#9_11 .event-details .ongoing-event-title' ).append(extraExcerpt)
 $('#9_12 .event-details .ongoing-event-title').append(extraExcerpt)
 
 $('#10_23 .closed-event').append("<p class='holiday-event'>Thanksgiving</p><br>")
$('#11_24 .closed-event').append("<p class='holiday-event'>Christmas Eve</p><br>")
 $('#11_25 .closed-event').append("<p class='holiday-event'>Christmas</p><br>")
 $('#11_31 .closed-event').append("<p class='holiday-event'>New Years Eve</p><br>")
 $('#0_1 .closed-event').append("<p class='holiday-event'>New Years Day</p><br>")
 
</script>