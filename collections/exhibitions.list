<style>
  #headerIcon {display: none!important;}
</style>

<script>

function isDateInFutureOrPast(start, end, id) {
  const today = new Date();
  const targetDiv = document.getElementById(id)
  const startDate = new Date(start)
  const endDate = new Date(end)
  
  
var eventTypeDiv = document.getElementById("eventType-" + id)

  if (startDate > today) {
    targetDiv.classList.add("future-event")
    eventTypeDiv.innerHTML = "Upcoming"
  } else if (startDate < today && endDate > today){
    targetDiv.classList.add("current-event")
    eventTypeDiv.innerHTML = "<span style='background-color: rgba(255,255,255,0.5); color: black; padding: 2px;'>On View</span>"
  } else if (startDate < today) {
    targetDiv.classList.add("past-event")
    eventTypeDiv.innerHTML = "Past Event"
  }  else {
    console.log("no event defined")
  }

}
</script>

<section id="exhibitions-list">

<div class="exhibitions-panel flex-start-start">
  <h5 id="on-view-cat" class="active-cat hover" onclick="toggleSections('onview')">On View & Upcoming</h5>
  <h5 >&nbsp;/&nbsp;</h5>
  <h5 id="archive-cat" class="hover" onclick="toggleSections('archive')">Archive</h5>
</div>
<div class="flex-start-spacebetween frames-container">
  <img src="../assets/frame-decor.svg" alt="decorative frame">
  <img src="../assets/frame-decor.svg" alt="decorative frame" style="transform: scaleX(-1)">
</div>

<div id="events-list" class="flex-start-start flex-column-reverse">

<div id="noExhibitions" style="display: none;">
  <p style="padding: 20px; text-align: center;"><i>No events to show</i></p>
</div>



{.if items}
  {.repeated section items}
    
      <div class="exhibition fade-in" id="{id}" data-event-date="{structuredContent.startDate|date %Y-%m-%dT%T}">
          <div class="exhibition-content">
              {.if customContent.dateNotDefined}<h6 class="red-text"><span class="exhibition-type-label" id="eventType-{id}"></span><br style="margin-bottom: 10px;">{structuredContent.startDate|date %B %Y}</h6>{.or}
              <h6 class="red-text"><span class="exhibition-type-label" id="eventType-{id}"></span><br style="margin-bottom: 10px;"> {structuredContent.startDate|date %B %d} - {structuredContent.endDate|date %B %d, %Y} </h6>
              {.end}
              
              <h3 onclick="window.open('{fullUrl}', '_self')">{title}</h3>
              
              {.if excerpt}
                <p class="light-weight" style="font-size: 12px!important;"><i>{excerpt}</i></p>
              {.end}
              <script>isDateInFutureOrPast(`{structuredContent.startDate|date %Y-%m-%dT%T}`, `{structuredContent.endDate|date %Y-%m-%dT%T}`, `{id}`)</script>
              
                {.if customContent.hideArtistTags}
                {.or}
                
                {.if tags}
                <img src="../assets/spear.svg" alt="decorative frame" style=" margin-right: 10px;">
                <div class="artist-tags-wrapper flex-start-start flex-wrap">

                  {.repeated section tags}
                    <a class="artist-tag hover" href="/artists/{@|url-encode}">{@}</a>
                  {.end}
                  </div>
                {.end}
                {.end}
              
              
          </div>
      
      </div>
    
  {.end}
  {.or}
    <p>No events that fit this criteria.</p>
  {.end}
</div>

<div class="flex-start-spacebetween frames-container" style="margin-top: -50px;">
  <img src="../assets/frame-decor.svg" alt="decorative frame" style="transform: scaleY(-1)">
  <img src="../assets/frame-decor.svg" alt="decorative frame" style="transform: rotate(180deg)">
</div>


</section>


<script>

function isSooner(date1, date2) {
  return new Date(date1) > new Date(date2);
}

function sortDatesBySoonest(arr) {
  try {
    const sortedDates = arr.sort((a, b) => new Date(a) - new Date(b));
    return sortedDates;
  } catch (error) {
    console.error("Error: Please make sure all elements in the array are valid date strings.");
    return null;
  }
}

function checkAndSortDates(arr) {
  const result = [];
  if (arr.length <= 1) {
    return arr;
  }

  for (let i = 0; i < arr.length - 1; i++) {
    if (isSooner(arr[i], arr[i + 1])) {
      result.push(arr[i]);
    } else {
      result.unshift(arr[i]);
    }
  }
  result.push(arr[arr.length - 1]);

  return sortDatesBySoonest(result);
}

function toggleSections(section){
  var events = document.getElementsByClassName('exhibition')
  var eventsLength = events.length;

  var archivedEvents = document.getElementsByClassName('past-event')
  var archivedEventsLength = archivedEvents.length;

  var currentEvents = document.getElementsByClassName('current-event')
  var currentEventsLength = currentEvents.length;

  var futureEvents = document.getElementsByClassName('future-event')
  var futureEventsLength = futureEvents.length; 

  var upcomingEvents = [...futureEvents, ...currentEvents]
  const sortedDates = checkAndSortDates(futureEvents);
  var sortedDatesLength = sortedDates.length;
    
  console.log(upcomingEvents)
  console.log(sortedDates)
  if (archivedEventsLength === 0 && section === 'archive'){
    document.getElementById('noExhibitions').style.display = "block"
  } else {
    document.getElementById('noExhibitions').style.display = "none"
  }


  for (i=0; i < eventsLength; i++){
    events[i].classList.remove('show-event')
  }
  if (section === 'onview'){
    document.getElementById('archive-cat').classList.remove('active-cat')
    document.getElementById('on-view-cat').classList.add('active-cat')
    for (i=0; i < currentEventsLength; i++){
      currentEvents[i].classList.add('show-event')
      
    }
    for (i=0; i < futureEventsLength; i++){
      futureEvents[i].classList.add('show-event')
      futureEvents[i].style.order = [i]
    }

    
  } else {
    document.getElementById('archive-cat').classList.add('active-cat')
    document.getElementById('on-view-cat').classList.remove('active-cat')
    for (i=0; i < archivedEventsLength; i++){
      archivedEvents[i].classList.add('show-event')
    }
  }
}

toggleSections('onview')
</script>